#!/bin/bash

source environment.conf

rm -rf $results_path

mkdir $code_path
mkdir $results_path

if [ ! -d $code_path/$promethee_path ]; then
	git clone $promethee_url -b $promethee_branch
	mv $promethee_path $code_path
	git --git-dir=$code_path/$promethee_path/.git checkout --detach $promethee_version
fi

if [ ! -d $code_path/$tiff_utils_path ]; then
	git clone $tiff_utils_url
	mv $tiff_utils_path $code_path
	git --git-dir=$code_path/$tiff_utils_path/.git checkout --detach $tiff_utils_version
fi

if [ ! -e $code_path/$umbu_caja_path/$tiff_name ]; then
	g++ -std=c++14 $code_path/$tiff_utils_path/tifGenerator.cpp -o $code_path/$tiff_utils_path/tifGenerator -ltiff
	
	./$code_path/$tiff_utils_path/tifGenerator 4000 $tiff_name -R
	rm $code_path/$tiff_utils_path/tifGenerator	
	
	mv $tiff_name $code_path/$umbu_caja_path
fi

echo $tiff_name 1 1 > $code_path/$umbu_caja_path/criteria

g++ -std=c++14 $code_path/$umbu_caja_path/umbu.cpp -o $code_path/$umbu_caja_path/umbu -ltiff
g++ -std=c++14 $code_path/$umbu_caja_path/merge.cpp -o $code_path/$umbu_caja_path/merge -ltiff
